<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gradius Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        
        #gameContainer {
            position: relative;
            border: 2px solid #333;
            background: linear-gradient(180deg, #000428 0%, #004e92 100%);
            overflow: hidden;
        }
        
        #gameCanvas {
            display: block;
            background: transparent;
        }
        
        #gameUI {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #00ff00;
            font-size: 14px;
            z-index: 10;
            text-shadow: 0 0 5px #00ff00;
        }
        
        #powerUpBar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #ffff00;
            font-size: 12px;
            z-index: 10;
        }
        
        .star {
            position: absolute;
            background: white;
            width: 1px;
            height: 1px;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameUI">
            <div>SCORE: <span id="score">000000</span></div>
            <div>LIVES: <span id="lives">3</span></div>
            <div>STAGE: <span id="stage">1</span></div>
        </div>
        <div id="powerUpBar">
            POWER UP: <span id="powerLevel">□□□□□</span>
        </div>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const GAME_WIDTH = 800;
        const GAME_HEIGHT = 600;
        const PLAYER_SPEED = 4;
        const BULLET_SPEED = 8;
        const ENEMY_SPEED = 2;
        
        let score = 0;
        let lives = 3;
        let stage = 1;
        let powerLevel = 0;
        let gameRunning = true;
        let keys = {};
        let stars = [];
        
        for (let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * GAME_WIDTH,
                y: Math.random() * GAME_HEIGHT,
                speed: Math.random() * 2 + 0.5,
                brightness: Math.random()
            });
        }
        
        class Player {
            constructor() {
                this.x = 50;
                this.y = GAME_HEIGHT / 2;
                this.width = 40;
                this.height = 20;
                this.health = 100;
                this.maxHealth = 100;
                this.lastShot = 0;
                this.shootDelay = 150;
            }
            
            update() {
                if (keys['ArrowUp'] || keys['w'] || keys['W']) {
                    this.y = Math.max(0, this.y - PLAYER_SPEED);
                }
                if (keys['ArrowDown'] || keys['s'] || keys['S']) {
                    this.y = Math.min(GAME_HEIGHT - this.height, this.y + PLAYER_SPEED);
                }
                if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
                    this.x = Math.max(0, this.x - PLAYER_SPEED);
                }
                if (keys['ArrowRight'] || keys['d'] || keys['D']) {
                    this.x = Math.min(GAME_WIDTH - this.width, this.x + PLAYER_SPEED);
                }
                
                if (keys[' '] || keys['z'] || keys['Z']) {
                    this.shoot();
                }
            }
            
            shoot() {
                const now = Date.now();
                if (now - this.lastShot > this.shootDelay) {
                    const bulletY = this.y + this.height / 2;
                    
                    if (powerLevel === 0) {
                        playerBullets.push(new Bullet(this.x + this.width, bulletY, BULLET_SPEED, 0));
                    } else if (powerLevel === 1) {
                        playerBullets.push(new Bullet(this.x + this.width, bulletY - 5, BULLET_SPEED, 0));
                        playerBullets.push(new Bullet(this.x + this.width, bulletY + 5, BULLET_SPEED, 0));
                    } else if (powerLevel === 2) {
                        playerBullets.push(new Bullet(this.x + this.width, bulletY, BULLET_SPEED, 0));
                        playerBullets.push(new Bullet(this.x + this.width, bulletY - 10, BULLET_SPEED, -0.1));
                        playerBullets.push(new Bullet(this.x + this.width, bulletY + 10, BULLET_SPEED, 0.1));
                    } else if (powerLevel >= 3) {
                        playerBullets.push(new Bullet(this.x + this.width, bulletY, BULLET_SPEED, 0));
                        playerBullets.push(new Bullet(this.x + this.width, bulletY - 10, BULLET_SPEED, -0.2));
                        playerBullets.push(new Bullet(this.x + this.width, bulletY + 10, BULLET_SPEED, 0.2));
                        playerBullets.push(new Bullet(this.x + this.width, bulletY - 15, BULLET_SPEED, -0.3));
                        playerBullets.push(new Bullet(this.x + this.width, bulletY + 15, BULLET_SPEED, 0.3));
                    }
                    
                    this.lastShot = now;
                }
            }
            
            draw() {
                ctx.fillStyle = '#00aaff';
                ctx.fillRect(this.x, this.y + 8, this.width - 10, 4);
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(this.x + 10, this.y, 20, this.height);
                
                ctx.fillStyle = '#ff4444';
                ctx.fillRect(this.x + 25, this.y + 6, 8, 8);
                
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(this.x + 30, this.y + 4, 10, 2);
                ctx.fillRect(this.x + 30, this.y + 14, 10, 2);
                
                ctx.fillStyle = '#ffaa00';
                ctx.fillRect(this.x + 35, this.y + 8, 5, 4);
                
                const healthBarWidth = 40;
                const healthBarHeight = 4;
                const healthPercent = this.health / this.maxHealth;
                
                ctx.fillStyle = '#333';
                ctx.fillRect(this.x, this.y - 10, healthBarWidth, healthBarHeight);
                ctx.fillStyle = this.health > 30 ? '#00ff00' : '#ff0000';
                ctx.fillRect(this.x, this.y - 10, healthBarWidth * healthPercent, healthBarHeight);
            }
            
            takeDamage(amount) {
                this.health -= amount;
                if (this.health <= 0) {
                    lives--;
                    this.health = this.maxHealth;
                    this.x = 50;
                    this.y = GAME_HEIGHT / 2;
                    powerLevel = Math.max(0, powerLevel - 1);
                    updateUI();
                }
            }
        }
        
        class Bullet {
            constructor(x, y, speedX, speedY) {
                this.x = x;
                this.y = y;
                this.speedX = speedX;
                this.speedY = speedY;
                this.width = 8;
                this.height = 3;
                this.active = true;
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                
                if (this.x < 0 || this.x > GAME_WIDTH || this.y < 0 || this.y > GAME_HEIGHT) {
                    this.active = false;
                }
            }
            
            draw() {
                ctx.fillStyle = '#ffff00';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(this.x + 1, this.y + 1, this.width - 2, 1);
            }
        }
        
        class Enemy {
            constructor(x, y, type = 0) {
                this.x = x;
                this.y = y;
                this.width = 30;
                this.height = 20;
                this.speedX = -ENEMY_SPEED;
                this.speedY = Math.sin(Date.now() / 1000) * 0.5;
                this.health = type === 0 ? 10 : 30;
                this.maxHealth = this.health;
                this.type = type;
                this.lastShot = 0;
                this.shootDelay = 1000 + Math.random() * 1000;
                this.active = true;
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                
                if (this.type === 1) {
                    this.y += Math.sin(this.x / 50) * 1;
                }
                
                if (this.x < -this.width || this.health <= 0) {
                    this.active = false;
                }
                
                const now = Date.now();
                if (now - this.lastShot > this.shootDelay && this.x < GAME_WIDTH - 100) {
                    enemyBullets.push(new EnemyBullet(this.x, this.y + this.height / 2));
                    this.lastShot = now;
                }
            }
            
            draw() {
                if (this.type === 0) {
                    ctx.fillStyle = '#ff4444';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    
                    ctx.fillStyle = '#aa0000';
                    ctx.fillRect(this.x + 5, this.y + 5, this.width - 10, this.height - 10);
                    
                    ctx.fillStyle = '#ffaa00';
                    ctx.fillRect(this.x, this.y + 8, 8, 4);
                } else {
                    ctx.fillStyle = '#4444ff';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                    
                    ctx.fillStyle = '#0000aa';
                    ctx.fillRect(this.x + 5, this.y + 5, this.width - 10, this.height - 10);
                    
                    ctx.fillStyle = '#ff00ff';
                    ctx.fillRect(this.x, this.y + 6, 8, 8);
                }
                
                const healthBarWidth = this.width;
                const healthBarHeight = 2;
                const healthPercent = this.health / this.maxHealth;
                
                ctx.fillStyle = '#333';
                ctx.fillRect(this.x, this.y - 5, healthBarWidth, healthBarHeight);
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(this.x, this.y - 5, healthBarWidth * healthPercent, healthBarHeight);
            }
            
            takeDamage(amount) {
                this.health -= amount;
                if (this.health <= 0) {
                    score += this.type === 0 ? 100 : 300;
                    
                    if (Math.random() < 0.3) {
                        powerUps.push(new PowerUp(this.x, this.y));
                    }
                    
                    updateUI();
                }
            }
        }
        
        class EnemyBullet {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.speedX = -4;
                this.speedY = (Math.random() - 0.5) * 2;
                this.width = 6;
                this.height = 6;
                this.active = true;
            }
            
            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                
                if (this.x < 0 || this.x > GAME_WIDTH || this.y < 0 || this.y > GAME_HEIGHT) {
                    this.active = false;
                }
            }
            
            draw() {
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(this.x + 2, this.y + 2, 2, 2);
            }
        }
        
        class PowerUp {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.width = 16;
                this.height = 16;
                this.speedX = -1;
                this.active = true;
                this.rotation = 0;
            }
            
            update() {
                this.x += this.speedX;
                this.rotation += 0.1;
                
                if (this.x < -this.width) {
                    this.active = false;
                }
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
                ctx.rotate(this.rotation);
                
                ctx.fillStyle = '#ffaa00';
                ctx.fillRect(-this.width / 2, -this.height / 2, this.width, this.height);
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(-this.width / 4, -this.height / 4, this.width / 2, this.height / 2);
                
                ctx.restore();
            }
        }
        
        let player = new Player();
        let playerBullets = [];
        let enemies = [];
        let enemyBullets = [];
        let powerUps = [];
        let enemySpawnTimer = 0;
        
        function updateUI() {
            document.getElementById('score').textContent = score.toString().padStart(6, '0');
            document.getElementById('lives').textContent = lives;
            document.getElementById('stage').textContent = stage;
            
            const powerBar = '■'.repeat(powerLevel) + '□'.repeat(5 - powerLevel);
            document.getElementById('powerLevel').textContent = powerBar;
        }
        
        function checkCollisions() {
            playerBullets.forEach(bullet => {
                enemies.forEach(enemy => {
                    if (bullet.active && enemy.active &&
                        bullet.x < enemy.x + enemy.width &&
                        bullet.x + bullet.width > enemy.x &&
                        bullet.y < enemy.y + enemy.height &&
                        bullet.y + bullet.height > enemy.y) {
                        bullet.active = false;
                        enemy.takeDamage(10);
                    }
                });
            });
            
            enemyBullets.forEach(bullet => {
                if (bullet.active &&
                    bullet.x < player.x + player.width &&
                    bullet.x + bullet.width > player.x &&
                    bullet.y < player.y + player.height &&
                    bullet.y + bullet.height > player.y) {
                    bullet.active = false;
                    player.takeDamage(20);
                }
            });
            
            enemies.forEach(enemy => {
                if (enemy.active &&
                    enemy.x < player.x + player.width &&
                    enemy.x + enemy.width > player.x &&
                    enemy.y < player.y + player.height &&
                    enemy.y + enemy.height > player.y) {
                    enemy.active = false;
                    player.takeDamage(30);
                }
            });
            
            powerUps.forEach(powerUp => {
                if (powerUp.active &&
                    powerUp.x < player.x + player.width &&
                    powerUp.x + powerUp.width > player.x &&
                    powerUp.y < player.y + player.height &&
                    powerUp.y + powerUp.height > player.y) {
                    powerUp.active = false;
                    powerLevel = Math.min(5, powerLevel + 1);
                    updateUI();
                }
            });
        }
        
        function spawnEnemies() {
            enemySpawnTimer++;
            
            if (enemySpawnTimer % 120 === 0) {
                const y = Math.random() * (GAME_HEIGHT - 50) + 25;
                const type = Math.random() < 0.7 ? 0 : 1;
                enemies.push(new Enemy(GAME_WIDTH, y, type));
            }
        }
        
        function drawStars() {
            stars.forEach(star => {
                star.x -= star.speed;
                if (star.x < 0) {
                    star.x = GAME_WIDTH;
                    star.y = Math.random() * GAME_HEIGHT;
                }
                
                ctx.fillStyle = `rgba(255, 255, 255, ${star.brightness})`;
                ctx.fillRect(star.x, star.y, 1, 1);
            });
        }
        
        function gameLoop() {
            if (!gameRunning || lives <= 0) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
                ctx.fillStyle = '#ffffff';
                ctx.font = '48px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText(lives <= 0 ? 'GAME OVER' : 'PAUSED', GAME_WIDTH / 2, GAME_HEIGHT / 2);
                
                if (lives <= 0) {
                    ctx.font = '24px Courier New';
                    ctx.fillText('Press R to restart', GAME_WIDTH / 2, GAME_HEIGHT / 2 + 80);
                }
                return;
            }
            
            ctx.clearRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            
            drawStars();
            
            player.update();
            
            spawnEnemies();
            
            playerBullets.forEach(bullet => bullet.update());
            enemies.forEach(enemy => enemy.update());
            enemyBullets.forEach(bullet => bullet.update());
            powerUps.forEach(powerUp => powerUp.update());
            
            checkCollisions();
            
            playerBullets = playerBullets.filter(bullet => bullet.active);
            enemies = enemies.filter(enemy => enemy.active);
            enemyBullets = enemyBullets.filter(bullet => bullet.active);
            powerUps = powerUps.filter(powerUp => powerUp.active);
            
            player.draw();
            playerBullets.forEach(bullet => bullet.draw());
            enemies.forEach(enemy => enemy.draw());
            enemyBullets.forEach(bullet => bullet.draw());
            powerUps.forEach(powerUp => powerUp.draw());
            
            requestAnimationFrame(gameLoop);
        }
        
        function resetGame() {
            score = 0;
            lives = 3;
            stage = 1;
            powerLevel = 0;
            player = new Player();
            playerBullets = [];
            enemies = [];
            enemyBullets = [];
            powerUps = [];
            enemySpawnTimer = 0;
            gameRunning = true;
            updateUI();
        }
        
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === 'p' || e.key === 'P') {
                gameRunning = !gameRunning;
                if (gameRunning) gameLoop();
            }
            if (e.key === 'r' || e.key === 'R') {
                if (lives <= 0) resetGame();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        updateUI();
        gameLoop();
    </script>
</body>
</html>